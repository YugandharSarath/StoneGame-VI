<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stone Game VI - Algorithm Visualizer</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin
        src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .stone-game-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .header .description {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
        }

        .input-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .array-input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            font-family: 'Courier New', monospace;
        }

        .array-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .input-help {
            font-size: 0.9rem;
            color: #666;
            margin-top: 4px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .calculate-btn,
        .reset-btn,
        .example-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .calculate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 2;
            min-width: 140px;
        }

        .calculate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .calculate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .reset-btn {
            background: #f8f9fa;
            color: #666;
            border: 2px solid #e9ecef;
            flex: 1;
            min-width: 100px;
        }

        .reset-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .example-btn {
            background: #28a745;
            color: white;
            flex: 1;
            min-width: 120px;
        }

        .example-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .error {
            background: #fee;
            color: #c53030;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #fed7d7;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .result-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .result {
            text-align: center;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
        }

        .alice-wins {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
        }

        .bob-wins {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            color: white;
        }

        .draw {
            background: linear-gradient(135deg, #ffa500, #ff8c00);
            color: white;
        }

        .result h2 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .score-display {
            display: flex;
            justify-content: space-around;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .player-score {
            text-align: center;
        }

        .player-score h3 {
            color: #555;
            margin-bottom: 10px;
        }

        .player-score .score {
            font-size: 2rem;
            font-weight: bold;
        }

        .alice-score {
            color: #48bb78;
        }

        .bob-score {
            color: #f56565;
        }

        .stones-visualization {
            margin-bottom: 25px;
        }

        .stones-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .stone-card {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s ease;
        }

        .stone-card:hover {
            transform: translateY(-2px);
        }

        .stone-card.alice-picked {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .stone-card.bob-picked {
            border-color: #f56565;
            background: #fff5f5;
        }

        .stone-index {
            font-weight: bold;
            color: #666;
            margin-bottom: 8px;
        }

        .stone-values {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .alice-value,
        .bob-value {
            font-weight: 600;
        }

        .alice-value {
            color: #48bb78;
        }

        .bob-value {
            color: #f56565;
        }

        .combined-value {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 8px;
        }

        .pick-order {
            font-size: 0.8rem;
            font-weight: bold;
            color: #333;
        }

        .strategy-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .strategy-section h3 {
            margin-bottom: 20px;
            color: #555;
        }

        .strategy-explanation {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .optimal-order {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .order-item {
            background: #667eea;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .explanation-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .explanation-section h3 {
            margin-bottom: 20px;
            color: #555;
        }

        .explanation p {
            margin-bottom: 12px;
            line-height: 1.6;
            color: #666;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .stone-game-container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .header .description {
                font-size: 1rem;
            }

            .input-section,
            .result-section,
            .strategy-section,
            .explanation-section {
                padding: 20px;
            }

            .button-group {
                flex-direction: column;
            }

            .calculate-btn,
            .reset-btn,
            .example-btn {
                flex: 1;
            }

            .result h2 {
                font-size: 2rem;
            }

            .score-display {
                flex-direction: column;
                gap: 15px;
            }

            .stones-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .result h2 {
                font-size: 1.5rem;
            }

            .input-section,
            .result-section,
            .strategy-section,
            .explanation-section {
                padding: 15px;
            }

            .stones-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        function StoneGameVI() {
            const [aliceValues, setAliceValues] = React.useState('');
            const [bobValues, setBobValues] = React.useState('');
            const [result, setResult] = React.useState(null);
            const [gameAnalysis, setGameAnalysis] = React.useState(null);
            const [error, setError] = React.useState('');
            const [isLoading, setIsLoading] = React.useState(false);

            // Core algorithm - Greedy approach based on combined values
            const stoneGameVI = (aliceValues, bobValues) => {
                const n = aliceValues.length;

                // Create stones with their indices and combined values
                const stones = aliceValues.map((aliceVal, i) => ({
                    index: i,
                    aliceValue: aliceVal,
                    bobValue: bobValues[i],
                    combinedValue: aliceVal + bobValues[i] // Key insight!
                }));

                // Sort by combined value in descending order
                stones.sort((a, b) => b.combinedValue - a.combinedValue);

                let aliceScore = 0;
                let bobScore = 0;
                const pickOrder = [];

                // Alice picks on even turns (0, 2, 4...), Bob on odd turns (1, 3, 5...)
                for (let turn = 0; turn < n; turn++) {
                    const stone = stones[turn];
                    if (turn % 2 === 0) {
                        // Alice's turn
                        aliceScore += stone.aliceValue;
                        pickOrder.push({
                            turn: turn + 1,
                            player: 'Alice',
                            stone: stone,
                            scoreGained: stone.aliceValue
                        });
                    } else {
                        // Bob's turn
                        bobScore += stone.bobValue;
                        pickOrder.push({
                            turn: turn + 1,
                            player: 'Bob',
                            stone: stone,
                            scoreGained: stone.bobValue
                        });
                    }
                }

                // Determine winner
                let gameResult;
                if (aliceScore > bobScore) gameResult = 1;
                else if (bobScore > aliceScore) gameResult = -1;
                else gameResult = 0;

                return {
                    result: gameResult,
                    aliceScore,
                    bobScore,
                    stones,
                    pickOrder,
                    sortedStones: stones
                };
            };

            const parseArray = (str) => {
                try {
                    // Handle different input formats
                    let cleaned = str.trim();
                    if (cleaned.startsWith('[') && cleaned.endsWith(']')) {
                        cleaned = cleaned.slice(1, -1);
                    }

                    const numbers = cleaned.split(',').map(s => {
                        const num = parseInt(s.trim());
                        if (isNaN(num)) throw new Error('Invalid number');
                        return num;
                    });

                    return numbers;
                } catch (e) {
                    throw new Error('Invalid array format');
                }
            };

            const handleCalculate = () => {
                setError('');
                setResult(null);
                setGameAnalysis(null);

                try {
                    // Parse input arrays
                    const aliceArr = parseArray(aliceValues);
                    const bobArr = parseArray(bobValues);

                    // Validation
                    if (aliceArr.length === 0 || bobArr.length === 0) {
                        setError('Arrays cannot be empty');
                        return;
                    }

                    if (aliceArr.length !== bobArr.length) {
                        setError('Alice and Bob arrays must have the same length');
                        return;
                    }

                    if (aliceArr.length > 100000) {
                        setError('Array length cannot exceed 100,000');
                        return;
                    }

                    const hasInvalidValue = [...aliceArr, ...bobArr].some(val => val < 1 || val > 100);
                    if (hasInvalidValue) {
                        setError('All values must be between 1 and 100');
                        return;
                    }

                    setIsLoading(true);

                    // Use setTimeout to prevent UI blocking
                    setTimeout(() => {
                        try {
                            const analysis = stoneGameVI(aliceArr, bobArr);
                            setResult(analysis.result);
                            setGameAnalysis(analysis);
                            setIsLoading(false);
                        } catch (err) {
                            setError('An error occurred during calculation');
                            setIsLoading(false);
                        }
                    }, 100);

                } catch (err) {
                    setError(err.message);
                }
            };

            const handleReset = () => {
                setAliceValues('');
                setBobValues('');
                setResult(null);
                setGameAnalysis(null);
                setError('');
            };

            const loadExample = (exampleNum) => {
                const examples = [
                    { alice: '[1,3]', bob: '[2,1]' },
                    { alice: '[1,2]', bob: '[3,1]' },
                    { alice: '[2,4,3]', bob: '[1,6,7]' }
                ];

                if (examples[exampleNum]) {
                    setAliceValues(examples[exampleNum].alice);
                    setBobValues(examples[exampleNum].bob);
                    setError('');
                }
            };

            const getResultText = () => {
                if (result === 1) return 'Alice Wins!';
                if (result === -1) return 'Bob Wins!';
                return "It's a Draw!";
            };

            const getResultClass = () => {
                if (result === 1) return 'alice-wins';
                if (result === -1) return 'bob-wins';
                return 'draw';
            };

            return React.createElement(
                'div',
                { className: 'stone-game-container' },

                // Header
                React.createElement(
                    'div',
                    { className: 'header' },
                    React.createElement('h1', null, 'Stone Game VI'),
                    React.createElement('p', { className: 'description' },
                        'Alice and Bob take turns picking stones with different values. Both play optimally. Who wins?'
                    )
                ),

                // Input Section
                React.createElement(
                    'div',
                    { className: 'input-section' },
                    React.createElement(
                        'div',
                        { className: 'input-group' },
                        React.createElement('label', { htmlFor: 'alice-input' }, 'Alice\'s Values:'),
                        React.createElement('input', {
                            id: 'alice-input',
                            'data-testid': 'alice-values-input',
                            type: 'text',
                            className: 'array-input',
                            value: aliceValues,
                            onChange: (e) => setAliceValues(e.target.value),
                            placeholder: 'Enter array like: 1,3,5 or [1,3,5]'
                        }),
                        React.createElement('div', { className: 'input-help' },
                            'Enter comma-separated values (1-100 each)'
                        )
                    ),
                    React.createElement(
                        'div',
                        { className: 'input-group' },
                        React.createElement('label', { htmlFor: 'bob-input' }, 'Bob\'s Values:'),
                        React.createElement('input', {
                            id: 'bob-input',
                            'data-testid': 'bob-values-input',
                            type: 'text',
                            className: 'array-input',
                            value: bobValues,
                            onChange: (e) => setBobValues(e.target.value),
                            placeholder: 'Enter array like: 2,1,4 or [2,1,4]'
                        }),
                        React.createElement('div', { className: 'input-help' },
                            'Must have same length as Alice\'s values'
                        )
                    ),
                    React.createElement(
                        'div',
                        { className: 'button-group' },
                        React.createElement(
                            'button',
                            {
                                'data-testid': 'calculate-button',
                                onClick: handleCalculate,
                                disabled: isLoading || !aliceValues || !bobValues,
                                className: 'calculate-btn'
                            },
                            isLoading ? 'Calculating...' : 'Calculate Winner'
                        ),
                        React.createElement(
                            'button',
                            {
                                'data-testid': 'reset-button',
                                onClick: handleReset,
                                className: 'reset-btn'
                            },
                            'Reset'
                        ),
                        React.createElement(
                            'button',
                            {
                                onClick: () => loadExample(0),
                                className: 'example-btn'
                            },
                            'Example 1'
                        )
                    )
                ),

                // Error Display
                error && React.createElement(
                    'div',
                    { className: 'error', 'data-testid': 'error-message' },
                    error
                ),

                // Result Display
                result !== null && gameAnalysis && React.createElement(
                    'div',
                    { className: 'result-section' },
                    React.createElement(
                        'div',
                        {
                            className: `result ${getResultClass()}`,
                            'data-testid': 'result-display'
                        },
                        React.createElement('h2', null, getResultText()),
                        React.createElement('p', null,
                            `Final Score - Alice: ${gameAnalysis.aliceScore}, Bob: ${gameAnalysis.bobScore}`
                        )
                    ),

                    // Score Display
                    React.createElement(
                        'div',
                        { className: 'score-display' },
                        React.createElement(
                            'div',
                            { className: 'player-score' },
                            React.createElement('h3', null, 'Alice'),
                            React.createElement('div', { className: 'score alice-score' }, gameAnalysis.aliceScore)
                        ),
                        React.createElement(
                            'div',
                            { className: 'player-score' },
                            React.createElement('h3', null, 'Bob'),
                            React.createElement('div', { className: 'score bob-score' }, gameAnalysis.bobScore)
                        )
                    ),

                    // Stones Visualization
                    React.createElement(
                        'div',
                        { className: 'stones-visualization' },
                        React.createElement('h3', null, 'Stones (sorted by optimal picking order):'),
                        React.createElement(
                            'div',
                            { className: 'stones-grid', 'data-testid': 'stones-visualization' },
                            gameAnalysis.sortedStones.map((stone, pickIndex) => {
                                const isPicked = pickIndex < gameAnalysis.pickOrder.length;
                                const pickedBy = isPicked ? gameAnalysis.pickOrder[pickIndex].player : null;

                                return React.createElement(
                                    'div',
                                    {
                                        key: stone.index,
                                        className: `stone-card ${pickedBy === 'Alice' ? 'alice-picked' : pickedBy === 'Bob' ? 'bob-picked' : ''}`
                                    },
                                    React.createElement('div', { className: 'stone-index' }, `Stone ${stone.index}`),
                                    React.createElement(
                                        'div',
                                        { className: 'stone-values' },
                                        React.createElement('span', { className: 'alice-value' }, `A: ${stone.aliceValue}`),
                                        React.createElement('span', { className: 'bob-value' }, `B: ${stone.bobValue}`)
                                    ),
                                    React.createElement('div', { className: 'combined-value' },
                                        `Combined: ${stone.combinedValue}`
                                    ),
                                    isPicked && React.createElement('div', { className: 'pick-order' },
                                        `${pickedBy} picks (turn ${pickIndex + 1})`
                                    )
                                );
                            })
                        )
                    )
                ),

                // Strategy Analysis
                gameAnalysis && React.createElement(
                    'div',
                    { className: 'strategy-section' },
                    React.createElement('h3', null, 'Optimal Strategy Analysis'),
                    React.createElement(
                        'div',
                        { className: 'strategy-explanation' },
                        React.createElement('p', null,
                            'ðŸ§  Key Insight: Sort stones by their combined value (Alice\'s value + Bob\'s value) in descending order.'
                        ),
                        React.createElement('p', null,
                            'Why? Taking a stone gives you points AND denies your opponent points!'
                        ),
                        React.createElement('div', null,
                            React.createElement('strong', null, 'Picking Order:'),
                            React.createElement(
                                'div',
                                { className: 'optimal-order' },
                                gameAnalysis.pickOrder.map((pick, i) =>
                                    React.createElement('div', { key: i, className: 'order-item' },
                                        `${pick.turn}. ${pick.player} takes Stone ${pick.stone.index} (+${pick.scoreGained})`
                                    )
                                )
                            )
                        )
                    )
                ),

                // Algorithm Explanation
                React.createElement(
                    'div',
                    { className: 'explanation-section' },
                    React.createElement('h3', null, 'How it works'),
                    React.createElement(
                        'div',
                        { className: 'explanation' },
                        React.createElement('p', null,
                            '1. ðŸŽ¯ The key insight: When you pick a stone, you gain points AND prevent your opponent from gaining their points from that stone.'
                        ),
                        React.createElement('p', null,
                            '2. ðŸ§® Calculate the "combined value" for each stone: Alice\'s value + Bob\'s value.'
                        ),
                        React.createElement('p', null,
                            '3. ðŸ“Š Sort all stones by combined value in descending order.'
                        ),
                        React.createElement('p', null,
                            '4. ðŸŽ² Simulate optimal play: Alice picks 1st, 3rd, 5th... Bob picks 2nd, 4th, 6th...'
                        ),
                        React.createElement('p', null,
                            '5. âš¡ Time Complexity: O(n log n) for sorting, Space Complexity: O(n)'
                        )
                    )
                )
            );
        }

        function App() {
            return React.createElement(
                'div',
                { className: 'app' },
                React.createElement(StoneGameVI)
            );
        }

        const { createRoot } = ReactDOM;
        const root = createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>

</html>